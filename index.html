<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Acknowledgment System</title>
    <meta name="description" content="Digital Acknowledgment and Confirmation System">
    <meta name="author" content="Lovable">
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0f172a;
            margin-bottom: 1rem;
        }

        .header p {
            color: #64748b;
            font-size: 1.125rem;
            max-width: 32rem;
            margin: 0 auto;
        }

        /* Add Button */
        .add-button-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1.5rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-blue {
            background-color: #2563eb;
            color: white;
        }

        .btn-blue:hover {
            background-color: #1d4ed8;
        }

        .btn-green {
            background-color: #16a34a;
            color: white;
        }

        .btn-green:hover {
            background-color: #15803d;
        }

        .btn-red {
            background-color: #dc2626;
            color: white;
        }

        .btn-red:hover {
            background-color: #b91c1c;
        }

        .btn-outline {
            background-color: transparent;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-outline:hover {
            background-color: #f3f4f6;
        }

        .icon {
            font-size: 1rem;
        }

        /* Acknowledgment Grid */
        .acknowledgment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .acknowledgment-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .acknowledgment-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }

        .acknowledgment-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem;
            background-color: #eff6ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #3b82f6;
        }

        .acknowledgment-card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }

        .acknowledgment-card p {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: transparent;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            font-size: 1rem;
        }

        .delete-btn:hover {
            background-color: #fef2f2;
        }

        /* Card Styles */
        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }

        .card-content {
            padding: 1.5rem;
        }

        /* Search */
        .search-container {
            margin-bottom: 1.5rem;
        }

        .search-input-wrapper {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 0.75rem 0.5rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Submissions */
        .submissions-section {
            margin-top: 3rem;
        }

        .submissions-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .submission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .submission-item:hover {
            background-color: #f8fafc;
        }

        .submission-left {
            flex: 1;
        }

        .submission-left h3 {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .submission-left p {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.125rem;
        }

        .submission-right {
            text-align: right;
        }

        .submission-right p {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .submission-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            color: #16a34a;
            font-size: 0.875rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        .empty-state .icon {
            font-size: 3rem;
            opacity: 0.5;
            margin-bottom: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: scaleIn 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
        }

        .close {
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #6b7280;
        }

        .close:hover {
            color: #374151;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Section Inputs */
        .section-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .section-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .btn-remove-section {
            background-color: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .btn-remove-section:hover {
            background-color: #dc2626;
        }

        /* Remote Work Form Styles */
        .remote-work-content {
            background: white;
            padding: 2rem;
        }

        .remote-work-header {
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .arabic-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc2626;
            margin-bottom: 0.5rem;
            direction: rtl;
        }

        .subtitle {
            font-size: 1.125rem;
            color: #4b5563;
        }

        .content-section {
            margin-bottom: 1.5rem;
        }

        .arabic-content {
            direction: rtl;
            text-align: right;
            color: #1f2937;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .rules-list {
            direction: rtl;
            text-align: right;
            list-style: decimal inside;
            color: #1f2937;
        }

        .rules-list li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .notice {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .notice-content {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .notice-dot {
            width: 1rem;
            height: 1rem;
            background-color: #3b82f6;
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }

        .notice-text {
            color: #1e40af;
            font-size: 0.875rem;
        }

        .form-section {
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.375rem;
        }

        .form-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .form-row {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .checkbox {
            margin-top: 0.125rem;
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }

        .checkbox-label {
            flex: 1;
            color: #374151;
            line-height: 1.4;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 1rem;
            z-index: 1001;
            display: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-width: 24rem;
        }

        .toast.success {
            border-left: 4px solid #16a34a;
        }

        .toast.error {
            border-left: 4px solid #dc2626;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { 
                opacity: 0;
                transform: scale(0.95);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Digital Acknowledgment System</h1>
            <p>Select an acknowledgment type to complete your digital acknowledgment and confirmation</p>
        </div>

        <div class="add-button-container">
            <button id="addNewTypeBtn" class="btn btn-blue">
                ‚ûï Add New Acknowledgment Type
            </button>
        </div>

        <div id="acknowledgmentGrid" class="acknowledgment-grid"></div>

        <div id="submissionsSection" class="submissions-section" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        üìã Your Submissions
                    </h2>
                </div>
                <div class="card-content">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <span class="search-icon">üîç</span>
                            <input 
                                type="text" 
                                id="searchInput" 
                                class="search-input" 
                                placeholder="Search by employee name..."
                            >
                        </div>
                    </div>
                    <div id="submissionsList" class="submissions-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Acknowledgment Modal -->
    <div id="acknowledgmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Acknowledgment Form</h2>
                <span id="closeModal" class="close">&times;</span>
            </div>
            <div id="modalBody" class="modal-body"></div>
        </div>
    </div>

    <!-- Add Type Modal -->
    <div id="addTypeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Acknowledgment Type</h2>
                <span id="closeAddTypeModal" class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newTypeTitle">Title *</label>
                    <input type="text" id="newTypeTitle" class="form-input" placeholder="Enter acknowledgment title">
                </div>
                
                <div class="form-group">
                    <label for="newTypeDescription">Description *</label>
                    <textarea id="newTypeDescription" class="form-textarea" placeholder="Enter acknowledgment description"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="newTypeContent">Content (Optional)</label>
                    <textarea id="newTypeContent" class="form-textarea" placeholder="Enter detailed content or instructions"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Sections/Rules (Optional)</label>
                    <div id="sectionsContainer">
                        <div class="section-input-group">
                            <input type="text" class="section-input" placeholder="Enter section/rule">
                            <button type="button" class="btn-remove-section" onclick="removeSection(this)">Remove</button>
                        </div>
                    </div>
                    <button type="button" id="addSectionBtn" class="btn btn-outline" style="margin-top: 0.5rem;">
                        ‚ûï Add Section
                    </button>
                </div>
                
                <div class="modal-actions">
                    <button id="saveNewTypeBtn" class="btn btn-green">Save</button>
                    <button id="cancelNewTypeBtn" class="btn btn-red">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submission Details Modal -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Submission Details</h2>
                <span id="closeSubmissionModal" class="close">&times;</span>
            </div>
            <div id="submissionModalBody" class="modal-body"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <p id="toastMessage"></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Application State
        let acknowledgmentTypes = [
            {
                id: 'remote-work',
                title: 'Remote Area Working Acknowledgement',
                description: 'ÿ•ŸÇÿ±ÿßÿ± ÿ•ŸÑÿ™ÿ≤ÿßŸÖ ÿ®ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿπŸÖŸÑ ŸÅŸä ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÜÿßÿ¶Ÿäÿ©',
                icon: 'üíª',
                content: {
                    arabic: 'ÿ•ŸÇÿ±ÿßÿ± ÿ•ŸÑÿ™ÿ≤ÿßŸÖ ÿ®ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿπŸÖŸÑ ŸÅŸä ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÜÿßÿ¶Ÿäÿ©',
                    subtitle: 'Remote Area Working Acknowledgement',
                    description: `ÿ£ŸÇÿ± ÿ®ÿ£ŸÜŸÜŸä ÿ™ŸÇÿØŸÖÿ™ ÿ®ŸÜÿßÿ°ÿßŸã ÿπŸÑŸâ ÿ±ÿ∫ÿ®ÿ™Ÿä ŸàÿßÿÆÿ™Ÿäÿßÿ±Ÿä ÿ®ÿ∑ŸÑÿ® ÿßŸÑÿ£ŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿπŸÖŸÑ ŸÅŸä ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÜÿßÿ¶Ÿäÿ© ŸÑŸÖÿØÿ© ÿ≥ŸÜÿ™ŸäŸÜ ÿßŸà ŸÅŸä ÿßŸä ŸàŸÇÿ™ Ÿäÿ≠ÿØÿØ ÿ≠ÿ≥ÿ® ŸÖÿßŸäÿ™ÿ∑ŸÑÿ®Ÿá ÿßŸÑÿπŸÖŸÑ ÿ•ÿ≥ÿ™ŸÜÿßÿØÿßŸã ÿ•ŸÑŸâ ÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑÿ™ŸÜŸÇŸÑ ŸÅŸä ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ŸÖŸÜ ÿßŸÑÿµŸÜÿßÿπŸä

ŸÉŸÖÿß ÿ£ŸÜŸÜŸä ÿ£ŸàÿßŸÅŸÇ ÿπŸÑŸâ ÿßŸÑÿ¥ÿ±Ÿàÿ∑ ÿßŸÑŸàÿßÿ±ÿØÿ© ÿ£ÿØŸÜÿßŸá ÿßŸÑÿÆÿßÿµÿ© ÿ®ÿßŸÑÿπŸÖŸÑ ŸÅŸä ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÜÿßÿ¶Ÿäÿ©:-`,
                    rules: [
                        'ÿ•ÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ≥ŸÉŸÜ ÿßŸÑŸÖŸàŸÅÿ± ŸÖŸÜ ŸÇÿ®ŸÑ ÿßŸÑÿ¥ÿ±ŸÉÿ© ÿ∑ŸäŸÑÿ© ŸÅÿ™ÿ±ÿ© ÿßŸÑŸÜŸàÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸäÿ©.',
                        'ÿ•ÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖŸàÿßÿµŸÑÿßÿ™ ÿßŸÑŸÖŸàŸÅÿ±ÿ© ŸÖŸÜ ŸÇÿ®ŸÑ ÿßŸÑÿ¥ÿ±ŸÉÿ© ŸàÿπÿØŸÖ ÿ•ÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ© ÿßŸÑÿ¥ÿÆÿµŸäÿ© ŸÑŸÑÿ™ŸÜŸÇŸÑ ŸÑŸÑÿπŸÖŸÑ',
                        'ÿßŸÑÿ•ŸÑÿ™ÿ≤ÿßŸÖ Ÿàÿßÿ™ÿ®ÿßÿπ ÿ¨ŸÖŸäÿπ ÿ£ŸÜÿ∏ŸÖÿ© Ÿàÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ≥ŸÑÿßŸÖÿ© ŸàŸÅŸÇ ÿ≥Ÿäÿßÿ≥ÿßÿ™ Ÿàÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑÿ¥ÿ±ŸÉÿ©.'
                    ]
                }
            },
            {
                id: 'transfer',
                title: 'Transfer Acknowledgment',
                description: 'Acknowledge transfer policies and procedures',
                icon: 'üìÑ'
            },
            {
                id: 'safety',
                title: 'Safety Acknowledgment',
                description: 'Acknowledge safety protocols and guidelines',
                icon: 'üõ°Ô∏è'
            },
            {
                id: 'security',
                title: 'Security Acknowledgment',
                description: 'Acknowledge security policies and data protection',
                icon: '‚ö†Ô∏è'
            },
            {
                id: 'training',
                title: 'Training Acknowledgment',
                description: 'Acknowledge completion of mandatory training',
                icon: 'üë•'
            }
        ];

        let submissions = [];
        let currentSelectedType = '';
        let currentFormData = {
            requestNo: '',
            employeeName: '',
            acknowledged: false
        };

        // DOM Elements
        const acknowledgmentGrid = document.getElementById('acknowledgmentGrid');
        const submissionsSection = document.getElementById('submissionsSection');
        const submissionsList = document.getElementById('submissionsList');
        const searchInput = document.getElementById('searchInput');
        const acknowledgmentModal = document.getElementById('acknowledgmentModal');
        const addTypeModal = document.getElementById('addTypeModal');
        const submissionModal = document.getElementById('submissionModal');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            renderAcknowledmentTypes();
            setupEventListeners();
            updateSubmissionsDisplay();
        });

        // Event Listeners
        function setupEventListeners() {
            // Add new type button
            document.getElementById('addNewTypeBtn').addEventListener('click', openAddTypeModal);
            
            // Search input
            searchInput.addEventListener('input', handleSearch);
            
            // Modal close buttons
            document.getElementById('closeModal').addEventListener('click', closeAcknowledmentModal);
            document.getElementById('closeAddTypeModal').addEventListener('click', closeAddTypeModal);
            document.getElementById('closeSubmissionModal').addEventListener('click', closeSubmissionModal);
            
            // Add type modal buttons
            document.getElementById('saveNewTypeBtn').addEventListener('click', saveNewType);
            document.getElementById('cancelNewTypeBtn').addEventListener('click', closeAddTypeModal);
            document.getElementById('addSectionBtn').addEventListener('click', addSection);
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === acknowledgmentModal) {
                    closeAcknowledmentModal();
                }
                if (event.target === addTypeModal) {
                    closeAddTypeModal();
                }
                if (event.target === submissionModal) {
                    closeSubmissionModal();
                }
            });
        }

        // Render acknowledgment types
        function renderAcknowledmentTypes() {
            acknowledgmentGrid.innerHTML = '';
            
            acknowledgmentTypes.forEach(type => {
                const card = document.createElement('div');
                card.className = 'acknowledgment-card';
                card.onclick = () => selectAcknowledmentType(type.id);
                
                card.innerHTML = `
                    ${type.id.startsWith('custom-') ? 
                        `<button class="delete-btn" onclick="event.stopPropagation(); deleteType('${type.id}')">√ó</button>` : 
                        ''
                    }
                    <div class="acknowledgment-icon">${type.icon}</div>
                    <h3>${type.title}</h3>
                    <p>${type.description}</p>
                `;
                
                acknowledgmentGrid.appendChild(card);
            });
        }

        // Select acknowledgment type
        function selectAcknowledmentType(typeId) {
            currentSelectedType = typeId;
            currentFormData = {
                requestNo: `${new Date().getFullYear()}/${Math.floor(Math.random() * 1000000)}`,
                employeeName: '',
                acknowledged: false
            };
            openAcknowledmentModal();
        }

        // Open acknowledgment modal
        function openAcknowledmentModal() {
            const selectedType = acknowledgmentTypes.find(t => t.id === currentSelectedType);
            if (!selectedType) return;
            
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = selectedType.title;
            
            if (selectedType.id === 'remote-work' && selectedType.content) {
                modalBody.innerHTML = generateRemoteWorkForm(selectedType);
            } else {
                modalBody.innerHTML = generateStandardForm(selectedType);
            }
            
            acknowledgmentModal.style.display = 'block';
            updateFormInputs();
        }

        // Generate remote work form
        function generateRemoteWorkForm(type) {
            return `
                <div class="remote-work-content">
                    <div class="remote-work-header">
                        <h1 class="arabic-title">${type.content.arabic}</h1>
                        <h2 class="subtitle">${type.content.subtitle}</h2>
                    </div>
                    
                    <div class="content-section">
                        <div class="arabic-content">
                            <p>${type.content.description}</p>
                        </div>
                        
                        ${type.content.rules ? `
                        <div class="arabic-content">
                            <ol class="rules-list">
                                ${type.content.rules.map(rule => `<li>${rule}</li>`).join('')}
                            </ol>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="notice">
                        <div class="notice-content">
                            <div class="notice-dot"></div>
                            <p class="notice-text">
                                The content of this item will be sent as an e-mail message to the person or group assigned to the item.
                            </p>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Request Information</h3>
                        
                        <div class="form-row">
                            <label class="form-label">Request No:</label>
                            <input type="text" id="requestNoInput" class="form-input" value="${currentFormData.requestNo}">
                        </div>
                        
                        <div class="form-row">
                            <label class="form-label">Employee Name:</label>
                            <input type="text" id="employeeNameInput" class="form-input" placeholder="Enter employee name" value="${currentFormData.employeeName}">
                        </div>
                        
                        <div class="form-row">
                            <label class="form-label">Acknowledgment *</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="acknowledgedCheckbox" class="checkbox" ${currentFormData.acknowledged ? 'checked' : ''}>
                                <label for="acknowledgedCheckbox" class="checkbox-label">
                                    I acknowledge that I have read, understood and agree to the above policies and procedures
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button onclick="submitAcknowledgment()" class="btn btn-green">Submit</button>
                        <button onclick="downloadPDF()" class="btn btn-blue">Download PDF</button>
                        <button onclick="closeAcknowledmentModal()" class="btn btn-red">Cancel</button>
                    </div>
                </div>
            `;
        }

        // Generate standard form
        function generateStandardForm(type) {
            return `
                <div class="content-section">
                    <p>${type.description}</p>
                    ${type.content ? `
                        <div style="margin-top: 1rem;">
                            <p>${type.content.description || ''}</p>
                            ${type.content.rules ? `
                                <ul style="margin-top: 1rem; padding-left: 1rem;">
                                    ${type.content.rules.map(rule => `<li style="margin-bottom: 0.5rem;">${rule}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
                
                <div class="form-section">
                    <h3>Request Information</h3>
                    
                    <div class="form-row">
                        <label class="form-label">Request No:</label>
                        <input type="text" id="requestNoInput" class="form-input" value="${currentFormData.requestNo}">
                    </div>
                    
                    <div class="form-row">
                        <label class="form-label">Employee Name:</label>
                        <input type="text" id="employeeNameInput" class="form-input" placeholder="Enter employee name" value="${currentFormData.employeeName}">
                    </div>
                    
                    <div class="form-row">
                        <label class="form-label">Acknowledgment *</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="acknowledgedCheckbox" class="checkbox" ${currentFormData.acknowledged ? 'checked' : ''}>
                            <label for="acknowledgedCheckbox" class="checkbox-label">
                                I acknowledge that I have read, understood and agree to the above policies and procedures
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button onclick="submitAcknowledgment()" class="btn btn-green">Submit</button>
                    <button onclick="downloadPDF()" class="btn btn-blue">Download PDF</button>
                    <button onclick="closeAcknowledmentModal()" class="btn btn-red">Cancel</button>
                </div>
            `;
        }

        // Update form inputs
        function updateFormInputs() {
            setTimeout(() => {
                const requestNoInput = document.getElementById('requestNoInput');
                const employeeNameInput = document.getElementById('employeeNameInput');
                const acknowledgedCheckbox = document.getElementById('acknowledgedCheckbox');
                
                if (requestNoInput) {
                    requestNoInput.addEventListener('input', (e) => {
                        currentFormData.requestNo = e.target.value;
                    });
                }
                
                if (employeeNameInput) {
                    employeeNameInput.addEventListener('input', (e) => {
                        currentFormData.employeeName = e.target.value;
                    });
                }
                
                if (acknowledgedCheckbox) {
                    acknowledgedCheckbox.addEventListener('change', (e) => {
                        currentFormData.acknowledged = e.target.checked;
                    });
                }
            }, 100);
        }

        // Submit acknowledgment
        function submitAcknowledgment() {
            const requestNoInput = document.getElementById('requestNoInput');
            const employeeNameInput = document.getElementById('employeeNameInput');
            const acknowledgedCheckbox = document.getElementById('acknowledgedCheckbox');
            
            if (requestNoInput) currentFormData.requestNo = requestNoInput.value;
            if (employeeNameInput) currentFormData.employeeName = employeeNameInput.value;
            if (acknowledgedCheckbox) currentFormData.acknowledged = acknowledgedCheckbox.checked;
            
            if (!currentFormData.acknowledged) {
                showToast('Please check the acknowledgment box to continue.', 'error');
                return;
            }
            
            if (!currentFormData.employeeName.trim()) {
                showToast('Please enter the employee name.', 'error');
                return;
            }
            
            const selectedType = acknowledgmentTypes.find(t => t.id === currentSelectedType);
            const newSubmission = {
                id: Date.now().toString(),
                type: selectedType.title,
                employeeName: currentFormData.employeeName,
                requestNo: currentFormData.requestNo,
                date: new Date().toLocaleDateString(),
                acknowledged: currentFormData.acknowledged
            };
            
            submissions.push(newSubmission);
            closeAcknowledmentModal();
            updateSubmissionsDisplay();
            showToast('Your acknowledgment has been successfully recorded.', 'success');
        }

        // Download PDF function
        function downloadPDF() {
            const requestNoInput = document.getElementById('requestNoInput');
            const employeeNameInput = document.getElementById('employeeNameInput');
            const acknowledgedCheckbox = document.getElementById('acknowledgedCheckbox');
            
            if (requestNoInput) currentFormData.requestNo = requestNoInput.value;
            if (employeeNameInput) currentFormData.employeeName = employeeNameInput.value;
            if (acknowledgedCheckbox) currentFormData.acknowledged = acknowledgedCheckbox.checked;
            
            if (!currentFormData.acknowledged) {
                showToast('Please check the acknowledgment box to continue.', 'error');
                return;
            }
            
            if (!currentFormData.employeeName.trim()) {
                showToast('Please enter the employee name.', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const selectedType = acknowledgmentTypes.find(t => t.id === currentSelectedType);
            
            // Add content to PDF
            doc.setFontSize(20);
            doc.text(selectedType.title, 20, 30);
            
            doc.setFontSize(12);
            doc.text(`Request No: ${currentFormData.requestNo}`, 20, 50);
            doc.text(`Employee Name: ${currentFormData.employeeName}`, 20, 65);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 80);
            
            if (selectedType.content && selectedType.content.description) {
                doc.text('Description:', 20, 100);
                const splitDescription = doc.splitTextToSize(selectedType.content.description, 170);
                doc.text(splitDescription, 20, 115);
            }
            
            doc.text('Status: Acknowledged', 20, 200);
            
            // Save the PDF
            doc.save(`${selectedType.title.replace(/\s+/g, '_')}_${currentFormData.employeeName.replace(/\s+/g, '_')}.pdf`);
            
            showToast('PDF downloaded successfully!', 'success');
        }

        // Close acknowledgment modal
        function closeAcknowledmentModal() {
            acknowledgmentModal.style.display = 'none';
        }

        // Open add type modal
        function openAddTypeModal() {
            resetAddTypeForm();
            addTypeModal.style.display = 'block';
        }

        // Close add type modal
        function closeAddTypeModal() {
            addTypeModal.style.display = 'none';
        }

        // Reset add type form
        function resetAddTypeForm() {
            document.getElementById('newTypeTitle').value = '';
            document.getElementById('newTypeDescription').value = '';
            document.getElementById('newTypeContent').value = '';
            
            const sectionsContainer = document.getElementById('sectionsContainer');
            sectionsContainer.innerHTML = `
                <div class="section-input-group">
                    <input type="text" class="section-input" placeholder="Enter section/rule">
                    <button type="button" class="btn-remove-section" onclick="removeSection(this)">Remove</button>
                </div>
            `;
        }

        // Add section
        function addSection() {
            const sectionsContainer = document.getElementById('sectionsContainer');
            const newSection = document.createElement('div');
            newSection.className = 'section-input-group';
            newSection.innerHTML = `
                <input type="text" class="section-input" placeholder="Enter section/rule">
                <button type="button" class="btn-remove-section" onclick="removeSection(this)">Remove</button>
            `;
            sectionsContainer.appendChild(newSection);
        }

        // Remove section
        function removeSection(button) {
            const sectionsContainer = document.getElementById('sectionsContainer');
            const sectionGroups = sectionsContainer.querySelectorAll('.section-input-group');
            
            if (sectionGroups.length > 1) {
                button.parentElement.remove();
            }
        }

        // Save new type
        function saveNewType() {
            const title = document.getElementById('newTypeTitle').value.trim();
            const description = document.getElementById('newTypeDescription').value.trim();
            const content = document.getElementById('newTypeContent').value.trim();
            
            if (!title || !description) {
                showToast('Please fill in all required fields.', 'error');
                return;
            }
            
            const sectionInputs = document.querySelectorAll('.section-input');
            const rules = Array.from(sectionInputs)
                .map(input => input.value.trim())
                .filter(value => value !== '');
            
            const newType = {
                id: `custom-${Date.now()}`,
                title: title,
                description: description,
                icon: 'üìÑ',
                content: {
                    description: content,
                    rules: rules
                }
            };
            
            acknowledgmentTypes.push(newType);
            renderAcknowledmentTypes();
            closeAddTypeModal();
            showToast('New acknowledgment type has been created successfully.', 'success');
        }

        // Delete type
        function deleteType(typeId) {
            acknowledgmentTypes = acknowledgmentTypes.filter(type => type.id !== typeId);
            renderAcknowledmentTypes();
            showToast('Acknowledgment type has been deleted successfully.', 'success');
        }

        // Handle search
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            updateSubmissionsDisplay(searchTerm);
        }

        // Update submissions display
        function updateSubmissionsDisplay(searchTerm = '') {
            if (submissions.length === 0) {
                submissionsSection.style.display = 'none';
                return;
            }
            
            submissionsSection.style.display = 'block';
            
            const filteredSubmissions = submissions.filter(submission => 
                searchTerm === '' || 
                submission.employeeName.toLowerCase().includes(searchTerm)
            );
            
            if (filteredSubmissions.length === 0 && searchTerm) {
                submissionsList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üîç</div>
                        <p>No submissions found for "${searchTerm}"</p>
                        <p style="font-size: 0.875rem;">Try searching with a different employee name</p>
                    </div>
                `;
            } else if (filteredSubmissions.length === 0) {
                submissionsList.innerHTML = `
                    <div class="empty-state">
                        <p>Enter an employee name to search for submissions</p>
                    </div>
                `;
            } else {
                submissionsList.innerHTML = filteredSubmissions.map(submission => `
                    <div class="submission-item" onclick="openSubmissionModal('${submission.id}')">
                        <div class="submission-left">
                            <h3>${submission.type}</h3>
                            <p>Employee: ${submission.employeeName}</p>
                            <p>Request No: ${submission.requestNo}</p>
                        </div>
                        <div class="submission-right">
                            <p>${submission.date}</p>
                            <div class="submission-status">
                                ‚úÖ Acknowledged
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Open submission modal
        function openSubmissionModal(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (!submission) return;
            
            const modalBody = document.getElementById('submissionModalBody');
            modalBody.innerHTML = `
                <div class="content-section">
                    <h3>${submission.type}</h3>
                    <div style="margin-top: 1rem;">
                        <p><strong>Employee Name:</strong> ${submission.employeeName}</p>
                        <p><strong>Request No:</strong> ${submission.requestNo}</p>
                        <p><strong>Date:</strong> ${submission.date}</p>
                        <p><strong>Status:</strong> <span style="color: #16a34a;">‚úÖ Acknowledged</span></p>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button onclick="exportSubmissionPDF('${submission.id}')" class="btn btn-blue">üìÑ Export PDF</button>
                    <button onclick="closeSubmissionModal()" class="btn btn-outline">Close</button>
                </div>
            `;
            
            submissionModal.style.display = 'block';
        }

        // Export submission as PDF
        function exportSubmissionPDF(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (!submission) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add header
            doc.setFontSize(20);
            doc.text('Digital Acknowledgment Certificate', 20, 30);
            
            // Add submission details
            doc.setFontSize(14);
            doc.text(submission.type, 20, 55);
            
            doc.setFontSize(12);
            doc.text(`Request No: ${submission.requestNo}`, 20, 75);
            doc.text(`Employee Name: ${submission.employeeName}`, 20, 90);
            doc.text(`Submission Date: ${submission.date}`, 20, 105);
            doc.text(`Status: Acknowledged`, 20, 120);
            
            // Add acknowledgment statement
            doc.text('Acknowledgment Statement:', 20, 140);
            const statement = 'I acknowledge that I have read, understood and agree to the above policies and procedures';
            const splitStatement = doc.splitTextToSize(statement, 170);
            doc.text(splitStatement, 20, 155);
            
            // Add signature line
            doc.text('Digital Signature: ‚úì Acknowledged', 20, 185);
            doc.text(`Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`, 20, 200);
            
            // Add footer
            doc.setFontSize(10);
            doc.text('This is a digitally generated acknowledgment certificate.', 20, 280);
            
            // Save the PDF
            const fileName = `${submission.type.replace(/\s+/g, '_')}_${submission.employeeName.replace(/\s+/g, '_')}_${submission.requestNo}.pdf`;
            doc.save(fileName);
            
            showToast('PDF exported successfully!', 'success');
        }

        // Close submission modal
        function closeSubmissionModal() {
            submissionModal.style.display = 'none';
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>